<!DOCTYPE html>
<html lang="th">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>Kahoo ‚Äî Advanced Quiz Game</title>
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@400;600;800&display=swap" rel="stylesheet">
  <style>
    :root{
      --bg1:#6a11cb; --bg2:#2575fc;
      --card: rgba(255,255,255,.12);
      --glass: blur(10px);
      --accent:#ffbf3c;
      --success: #4caf50;
      --error: #f44336;
      --warning: #ff9800;
      --info: #2196f3;
      --opt1:#f44336; --opt2:#2196f3; --opt3:#4caf50; --opt4:#ff9800;
    }
    * { box-sizing: border-box; margin: 0; padding: 0; }
    
    body {
      color: #fff;
      font-family: "Poppins", system-ui, -apple-system, Segoe UI, Roboto, Arial;
      min-height: 100vh;
      display: flex;
      align-items: center;
      justify-content: center;
      background: radial-gradient(1200px 600px at 10% 10%, rgba(255,255,255,.08), transparent),
                  linear-gradient(135deg, var(--bg1), var(--bg2));
      overflow-x: hidden;
    }

    .wrap { 
      width: 100%; 
      max-width: 900px; 
      padding: 20px; 
      position: relative; 
    }

    .card {
      background: var(--card);
      border-radius: 18px;
      padding: 20px;
      margin: 15px 0;
      box-shadow: 0 20px 60px rgba(0,0,0,.25);
      backdrop-filter: var(--glass);
      animation: slideIn 0.4s ease;
      position: relative;
      overflow: hidden;
    }

    @keyframes slideIn {
      from { transform: translateY(20px); opacity: 0; }
      to { transform: translateY(0); opacity: 1; }
    }

    @keyframes pulse {
      0%, 100% { transform: scale(1); }
      50% { transform: scale(1.05); }
    }

    @keyframes shake {
      0%, 100% { transform: translateX(0); }
      25% { transform: translateX(-5px); }
      75% { transform: translateX(5px); }
    }

    h1, h2, h3 { margin: 8px 0 12px; }
    h1 { font-weight: 800; letter-spacing: .3px; text-align: center; }
    h2 { font-weight: 700; }

    input, select {
      width: 100%;
      padding: 12px 14px;
      border-radius: 12px;
      border: 1px solid rgba(255,255,255,.25);
      background: rgba(0,0,0,.2);
      color: #fff;
      outline: none;
      font-size: 14px;
      transition: all 0.3s ease;
    }

    input:focus, select:focus {
      border-color: var(--accent);
      box-shadow: 0 0 0 3px rgba(255, 191, 60, 0.2);
    }

    input::placeholder { color: #dfe7ffbf; }
    select option { background: #333; color: #fff; }

    .row { 
      display: flex; 
      gap: 10px; 
      flex-wrap: wrap; 
      margin: 10px 0; 
    }

    .col { flex: 1; min-width: 200px; }

    button {
      padding: 12px 16px;
      border: 0;
      border-radius: 12px;
      cursor: pointer;
      font-weight: 600;
      font-size: 14px;
      transition: all 0.2s ease;
      position: relative;
      overflow: hidden;
    }

    .btn {
      background: linear-gradient(135deg, #ff7b00, #ffbf3c);
      color: #222;
    }

    .btn.secondary {
      background: rgba(255,255,255,.2);
      color: #fff;
      border: 1px solid rgba(255,255,255,.25);
    }

    .btn.success {
      background: linear-gradient(135deg, #4caf50, #66bb6a);
      color: #fff;
    }

    .btn.danger {
      background: linear-gradient(135deg, #f44336, #ef5350);
      color: #fff;
    }

    button:hover:not(:disabled) {
      transform: translateY(-2px);
      filter: brightness(1.1);
      box-shadow: 0 8px 25px rgba(0,0,0,.2);
    }

    button:disabled {
      opacity: 0.6;
      cursor: not-allowed;
      transform: none;
    }

    button.loading::after {
      content: "";
      position: absolute;
      width: 16px;
      height: 16px;
      margin: auto;
      border: 2px solid transparent;
      border-top-color: #fff;
      border-radius: 50%;
      animation: spin 1s linear infinite;
    }

    @keyframes spin {
      0% { transform: rotate(0deg); }
      100% { transform: rotate(360deg); }
    }

    /* AUTH SECTION */
    .auth-tabs {
      display: flex;
      margin-bottom: 20px;
      background: rgba(0,0,0,.2);
      border-radius: 12px;
      padding: 4px;
    }

    .auth-tab {
      flex: 1;
      padding: 10px;
      text-align: center;
      border-radius: 8px;
      cursor: pointer;
      transition: all 0.3s ease;
    }

    .auth-tab.active {
      background: var(--accent);
      color: #222;
      font-weight: 600;
    }

    /* SETTINGS */
    .settings-grid {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
      gap: 15px;
      margin: 15px 0;
    }

    .form-group {
      display: flex;
      flex-direction: column;
      gap: 5px;
    }

    .form-group label {
      font-size: 12px;
      font-weight: 600;
      color: rgba(255,255,255,.8);
      text-transform: uppercase;
      letter-spacing: 0.5px;
    }

    /* LOBBY */
    .room-info {
      background: rgba(255,191,60,.1);
      border: 1px solid rgba(255,191,60,.3);
      border-radius: 12px;
      padding: 15px;
      margin: 15px 0;
      text-align: center;
    }

    .room-id {
      font-size: 24px;
      font-weight: 800;
      color: var(--accent);
      letter-spacing: 2px;
      margin: 5px 0;
    }

    .share-link {
      font-size: 12px;
      color: rgba(255,255,255,.7);
      word-break: break-all;
      cursor: pointer;
      transition: color 0.3s ease;
    }

    .share-link:hover {
      color: var(--accent);
    }

    .players-grid {
      display: grid;
      grid-template-columns: repeat(auto-fill, minmax(150px, 1fr));
      gap: 10px;
      margin: 15px 0;
    }

    .player-card {
      background: rgba(255,255,255,.15);
      border: 1px solid rgba(255,255,255,.25);
      padding: 12px;
      border-radius: 10px;
      text-align: center;
      transition: all 0.3s ease;
      position: relative;
    }

    .player-card.host::after {
      content: "üëë";
      position: absolute;
      top: -5px;
      right: -5px;
      font-size: 16px;
    }

    .player-card:hover {
      transform: translateY(-2px);
      background: rgba(255,255,255,.2);
    }

    /* GAME */
    .game-header {
      display: flex;
      justify-content: space-between;
      align-items: center;
      margin-bottom: 20px;
      flex-wrap: wrap;
      gap: 10px;
    }

    .question-info {
      display: flex;
      align-items: center;
      gap: 15px;
    }

    .progress-bar {
      width: 200px;
      height: 6px;
      background: rgba(255,255,255,.2);
      border-radius: 3px;
      overflow: hidden;
    }

    .progress-fill {
      height: 100%;
      background: linear-gradient(90deg, var(--accent), #ff7b00);
      transition: width 0.3s ease;
    }

    .category-badge {
      background: rgba(255,255,255,.2);
      padding: 4px 8px;
      border-radius: 12px;
      font-size: 12px;
      font-weight: 600;
    }

    .difficulty-badge {
      padding: 4px 8px;
      border-radius: 12px;
      font-size: 12px;
      font-weight: 600;
    }

    .difficulty-easy { background: var(--success); }
    .difficulty-medium { background: var(--warning); }
    .difficulty-hard { background: var(--error); }

    .question-text {
      font-size: 1.4rem;
      line-height: 1.4;
      margin: 20px 0;
      text-align: center;
    }

    .options-grid {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
      gap: 12px;
      margin-top: 20px;
    }

    .option {
      border: 0;
      color: #fff;
      font-weight: 700;
      text-align: left;
      padding: 20px;
      border-radius: 14px;
      position: relative;
      overflow: hidden;
      isolation: isolate;
      box-shadow: 0 10px 30px rgba(0,0,0,.2);
      transition: all 0.3s ease;
      cursor: pointer;
    }

    .option span {
      position: relative;
      z-index: 2;
    }

    .option::after {
      content: "";
      position: absolute;
      inset: 0;
      background: rgba(255,255,255,.12);
      opacity: 0;
      transition: opacity 0.2s;
      z-index: 1;
    }

    .option:hover:not(:disabled)::after {
      opacity: 0.25;
    }

    .option.selected {
      outline: 3px solid #fff;
      transform: scale(1.02);
      animation: pulse 0.6s ease;
    }

    .option.correct {
      outline: 3px solid var(--success);
      background: var(--success) !important;
    }

    .option.incorrect {
      outline: 3px solid var(--error);
      opacity: 0.7;
    }

    .opt1 { background: var(--opt1); }
    .opt2 { background: var(--opt2); }
    .opt3 { background: var(--opt3); }
    .opt4 { background: var(--opt4); }

    /* TIMER */
    .timer-container {
      display: flex;
      align-items: center;
      gap: 15px;
    }

    .timer-circle {
      width: 80px;
      height: 80px;
      border-radius: 50%;
      background: conic-gradient(var(--accent) calc(var(--pct) * 1%), rgba(255,255,255,.18) 0);
      display: flex;
      align-items: center;
      justify-content: center;
      font-weight: 800;
      color: #222;
      box-shadow: inset 0 0 0 8px rgba(0,0,0,.2), 0 8px 18px rgba(0,0,0,.2);
      transition: all 0.3s ease;
    }

    .timer-circle.warning {
      animation: pulse 1s infinite;
    }

    .timer-inner {
      width: 58px;
      height: 58px;
      border-radius: 50%;
      background: #fff;
      display: flex;
      align-items: center;
      justify-content: center;
      font-size: 18px;
      font-weight: 800;
    }

    /* SCOREBOARD */
    .scoreboard {
      display: flex;
      flex-direction: column;
      gap: 8px;
    }

    .score-row {
      display: flex;
      justify-content: space-between;
      align-items: center;
      padding: 12px 15px;
      background: rgba(255,255,255,.1);
      border-radius: 10px;
      transition: all 0.3s ease;
    }

    .score-row:first-child {
      background: linear-gradient(135deg, #ffd700, #ffed4e);
      color: #222;
      font-weight: 700;
      animation: glow 2s infinite alternate;
    }

    @keyframes glow {
      from { box-shadow: 0 0 10px rgba(255, 215, 0, 0.5); }
      to { box-shadow: 0 0 20px rgba(255, 215, 0, 0.8), 0 0 30px rgba(255, 215, 0, 0.3); }
    }

    .score-position {
      font-weight: 700;
      min-width: 30px;
    }

    .score-name {
      flex: 1;
      text-align: left;
    }

    .score-points {
      font-weight: 700;
    }

    /* NOTIFICATIONS */
    .notification {
      position: fixed;
      top: 20px;
      right: 20px;
      padding: 15px 20px;
      border-radius: 12px;
      color: #fff;
      font-weight: 600;
      box-shadow: 0 10px 30px rgba(0,0,0,.3);
      animation: slideInRight 0.3s ease;
      z-index: 1000;
    }

    .notification.success { background: var(--success); }
    .notification.error { background: var(--error); }
    .notification.warning { background: var(--warning); }
    .notification.info { background: var(--info); }

    @keyframes slideInRight {
      from { transform: translateX(100%); opacity: 0; }
      to { transform: translateX(0); opacity: 1; }
    }

    /* UTILITIES */
    .hide { display: none !important; }
    .text-center { text-align: center; }
    .text-muted { opacity: 0.7; }
    .mt-20 { margin-top: 20px; }
    .mb-20 { margin-bottom: 20px; }

    /* LOADING ANIMATION */
    .loading-dots::after {
      content: '';
      animation: dots 1.5s infinite;
    }

    @keyframes dots {
      0%, 20% { content: '.'; }
      40% { content: '..'; }
      60%, 100% { content: '...'; }
    }

    /* RESPONSIVE */
    @media (max-width: 768px) {
      .wrap { padding: 10px; }
      .card { padding: 15px; margin: 10px 0; }
      .game-header { flex-direction: column; text-align: center; }
      .timer-container { justify-content: center; }
      .options-grid { grid-template-columns: 1fr; }
      .settings-grid { grid-template-columns: 1fr; }
      .question-text { font-size: 1.2rem; }
    }

    /* DARK MODE TOGGLE */
    .theme-toggle {
      position: absolute;
      top: 20px;
      right: 20px;
      background: rgba(255,255,255,.2);
      border: 1px solid rgba(255,255,255,.3);
      border-radius: 20px;
      padding: 8px 12px;
      color: #fff;
      font-size: 12px;
      cursor: pointer;
      transition: all 0.3s ease;
    }

    .theme-toggle:hover {
      background: rgba(255,255,255,.3);
    }

    /* SOUND CONTROL */
    .sound-toggle {
      position: fixed;
      bottom: 20px;
      right: 20px;
      width: 50px;
      height: 50px;
      border-radius: 50%;
      background: var(--accent);
      border: 0;
      color: #222;
      font-size: 20px;
      cursor: pointer;
      box-shadow: 0 5px 15px rgba(0,0,0,.3);
      transition: all 0.3s ease;
      z-index: 1000;
    }

    .sound-toggle:hover {
      transform: scale(1.1);
    }

    .sound-toggle.muted {
      opacity: 0.5;
    }
  </style>
</head>
<body>
  <div class="wrap">
    <!-- AUTHENTICATION -->
    <div id="auth" class="card">
      <h1>üéÆ Kahoo ‚Äî Advanced Quiz</h1>
      
      <div class="auth-tabs">
        <div class="auth-tab active" data-tab="guest">üé≤ ‡πÄ‡∏•‡πà‡∏ô‡πÅ‡∏ö‡∏ö Guest</div>
        <div class="auth-tab" data-tab="login">üîë ‡πÄ‡∏Ç‡πâ‡∏≤‡∏™‡∏π‡πà‡∏£‡∏∞‡∏ö‡∏ö</div>
        <div class="auth-tab" data-tab="register">üìù ‡∏™‡∏°‡∏±‡∏Ñ‡∏£‡∏™‡∏°‡∏≤‡∏ä‡∏¥‡∏Å</div>
      </div>

      <!-- Guest Tab -->
      <div id="guest-tab" class="auth-content">
        <div class="form-group">
          <label>‡∏ä‡∏∑‡πà‡∏≠‡∏ú‡∏π‡πâ‡πÄ‡∏•‡πà‡∏ô</label>
          <input id="guestName" placeholder="‡πÉ‡∏™‡πà‡∏ä‡∏∑‡πà‡∏≠‡∏Ç‡∏≠‡∏á‡∏Ñ‡∏∏‡∏ì (‡πÄ‡∏ä‡πà‡∏ô Beam, New, Aom)" maxlength="30" />
        </div>
        <div class="row mt-20">
          <button id="createGuestBtn" class="btn col">üè† ‡∏™‡∏£‡πâ‡∏≤‡∏á‡∏´‡πâ‡∏≠‡∏á</button>
          <input id="joinRoomId" placeholder="‡∏£‡∏´‡∏±‡∏™‡∏´‡πâ‡∏≠‡∏á (‡πÄ‡∏ä‡πà‡∏ô ABC123)" maxlength="6" style="max-width: 150px;" />
          <button id="joinGuestBtn" class="btn secondary">üö™ ‡πÄ‡∏Ç‡πâ‡∏≤‡∏´‡πâ‡∏≠‡∏á</button>
        </div>
      </div>

      <!-- Login Tab -->
      <div id="login-tab" class="auth-content hide">
        <div class="form-group">
          <label>Username ‡∏´‡∏£‡∏∑‡∏≠ Email</label>
          <input id="loginInput" placeholder="username ‡∏´‡∏£‡∏∑‡∏≠ email@example.com" />
        </div>
        <div class="form-group">
          <label>‡∏£‡∏´‡∏±‡∏™‡∏ú‡πà‡∏≤‡∏ô</label>
          <input id="loginPassword" type="password" placeholder="‡∏£‡∏´‡∏±‡∏™‡∏ú‡πà‡∏≤‡∏ô" />
        </div>
        <button id="loginBtn" class="btn success col mt-20">‡πÄ‡∏Ç‡πâ‡∏≤‡∏™‡∏π‡πà‡∏£‡∏∞‡∏ö‡∏ö</button>
      </div>

      <!-- Register Tab -->
      <div id="register-tab" class="auth-content hide">
        <div class="form-group">
          <label>Username</label>
          <input id="registerUsername" placeholder="username (3-20 ‡∏ï‡∏±‡∏ß‡∏≠‡∏±‡∏Å‡∏©‡∏£)" maxlength="20" />
        </div>
        <div class="form-group">
          <label>Email</label>
          <input id="registerEmail" type="email" placeholder="email@example.com" />
        </div>
        <div class="form-group">
          <label>‡∏£‡∏´‡∏±‡∏™‡∏ú‡πà‡∏≤‡∏ô</label>
          <input id="registerPassword" type="password" placeholder="‡∏£‡∏´‡∏±‡∏™‡∏ú‡πà‡∏≤‡∏ô (‡∏≠‡∏¢‡πà‡∏≤‡∏á‡∏ô‡πâ‡∏≠‡∏¢ 6 ‡∏ï‡∏±‡∏ß)" />
        </div>
        <button id="registerBtn" class="btn success col mt-20">‡∏™‡∏°‡∏±‡∏Ñ‡∏£‡∏™‡∏°‡∏≤‡∏ä‡∏¥‡∏Å</button>
      </div>
    </div>

    <!-- GAME SETTINGS -->
    <div id="settings" class="card hide">
      <h2>‚öôÔ∏è ‡∏ï‡∏±‡πâ‡∏á‡∏Ñ‡πà‡∏≤‡πÄ‡∏Å‡∏°</h2>
      <div class="settings-grid">
        <div class="form-group">
          <label>‡∏à‡∏≥‡∏ô‡∏ß‡∏ô‡∏Ñ‡∏≥‡∏ñ‡∏≤‡∏°</label>
          <select id="questionCount">
            <option value="5">5 ‡∏Ç‡πâ‡∏≠</option>
            <option value="10" selected>10 ‡∏Ç‡πâ‡∏≠</option>
            <option value="15">15 ‡∏Ç‡πâ‡∏≠</option>
            <option value="20">20 ‡∏Ç‡πâ‡∏≠</option>
          </select>
        </div>
        <div class="form-group">
          <label>‡πÄ‡∏ß‡∏•‡∏≤‡∏ï‡∏≠‡∏ö (‡∏ß‡∏¥‡∏ô‡∏≤‡∏ó‡∏µ)</label>
          <select id="timeLimit">
            <option value="5">5 ‡∏ß‡∏¥‡∏ô‡∏≤‡∏ó‡∏µ</option>
            <option value="10" selected>10 ‡∏ß‡∏¥‡∏ô‡∏≤‡∏ó‡∏µ</option>
            <option value="15">15 ‡∏ß‡∏¥‡∏ô‡∏≤‡∏ó‡∏µ</option>
            <option value="20">20 ‡∏ß‡∏¥‡∏ô‡∏≤‡∏ó‡∏µ</option>
            <option value="30">30 ‡∏ß‡∏¥‡∏ô‡∏≤‡∏ó‡∏µ</option>
          </select>
        </div>
        <div class="form-group">
          <label>‡∏´‡∏°‡∏ß‡∏î‡∏´‡∏°‡∏π‡πà</label>
          <select id="category">
            <option value="">‡∏ó‡∏∏‡∏Å‡∏´‡∏°‡∏ß‡∏î‡∏´‡∏°‡∏π‡πà</option>
          </select>
        </div>
        <div class="form-group">
          <label>‡∏£‡∏∞‡∏î‡∏±‡∏ö‡∏Ñ‡∏ß‡∏≤‡∏°‡∏¢‡∏≤‡∏Å</label>
          <select id="difficulty">
            <option value="">‡∏ó‡∏∏‡∏Å‡∏£‡∏∞‡∏î‡∏±‡∏ö</option>
            <option value="easy">‡∏á‡πà‡∏≤‡∏¢</option>
            <option value="medium">‡∏õ‡∏≤‡∏ô‡∏Å‡∏•‡∏≤‡∏á</option>
            <option value="hard">‡∏¢‡∏≤‡∏Å</option>
          </select>
        </div>
      </div>
      <div class="row mt-20">
        <button id="saveSettings" class="btn col">üíæ ‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡πÅ‡∏•‡∏∞‡∏™‡∏£‡πâ‡∏≤‡∏á‡∏´‡πâ‡∏≠‡∏á</button>
        <button id="cancelSettings" class="btn secondary">‚ùå ‡∏¢‡∏Å‡πÄ‡∏•‡∏¥‡∏Å</button>
      </div>
    </div>

    <!-- LOBBY -->
    <div id="lobby" class="card hide">
      <h2>üè† ‡∏´‡πâ‡∏≠‡∏á‡∏£‡∏≠‡∏ú‡∏π‡πâ‡πÄ‡∏•‡πà‡∏ô</h2>
      
      <div class="room-info">
        <div>‡∏£‡∏´‡∏±‡∏™‡∏´‡πâ‡∏≠‡∏á</div>
        <div class="room-id" id="roomIdDisplay">ABC123</div>
        <div class="share-link" id="shareLink" onclick="copyShareLink()">
          ‡∏Ñ‡∏•‡∏¥‡∏Å‡πÄ‡∏û‡∏∑‡πà‡∏≠‡∏Ñ‡∏±‡∏î‡∏•‡∏≠‡∏Å‡∏•‡∏¥‡∏á‡∏Å‡πå‡πÄ‡∏ä‡∏¥‡∏ç üìã
        </div>
      </div>

      <h3>üë• ‡∏ú‡∏π‡πâ‡πÄ‡∏•‡πà‡∏ô‡πÉ‡∏ô‡∏´‡πâ‡∏≠‡∏á</h3>
      <div id="playersGrid" class="players-grid">
        <!-- Players will be populated here -->
      </div>

      <div class="text-center mt-20">
        <button id="startGameBtn" class="btn success" disabled>
          üöÄ ‡πÄ‡∏£‡∏¥‡πà‡∏°‡πÄ‡∏Å‡∏° <span class="loading-dots hide"></span>
        </button>
        <button id="leaveRoomBtn" class="btn danger">üö™ ‡∏≠‡∏≠‡∏Å‡∏à‡∏≤‡∏Å‡∏´‡πâ‡∏≠‡∏á</button>
      </div>
    </div>

    <!-- GAME -->
    <div id="game" class="card hide">
      <div class="game-header">
        <div class="question-info">
          <span>‡∏Ç‡πâ‡∏≠ <strong id="questionNumber">1</strong>/<span id="totalQuestions">10</span></span>
          <div class="progress-bar">
            <div class="progress-fill" id="progressFill"></div>
          </div>
          <div class="category-badge" id="questionCategory">General</div>
          <div class="difficulty-badge" id="questionDifficulty">Medium</div>
        </div>
        <div class="timer-container">
          <div class="timer-circle" id="timerCircle" style="--pct: 100">
            <div class="timer-inner" id="timerDisplay">10</div>
          </div>
        </div>
      </div>

      <div class="question-text" id="questionText">
        ‡∏Å‡∏≥‡∏•‡∏±‡∏á‡πÇ‡∏´‡∏•‡∏î‡∏Ñ‡∏≥‡∏ñ‡∏≤‡∏°...
      </div>

      <div class="options-grid" id="optionsGrid">
        <!-- Options will be populated here -->
      </div>
    </div>

    <!-- QUESTION SUMMARY -->
    <div id="summary" class="card hide">
      <h2>üìä ‡∏™‡∏£‡∏∏‡∏õ‡∏Ç‡πâ‡∏≠ <span id="summaryNumber">1</span>/<span id="summaryTotal">10</span></h2>
      
      <div id="answerReveal" class="text-center mb-20">
        <!-- Answer reveal will be shown here -->
      </div>

      <h3>üèÜ ‡∏Ñ‡∏∞‡πÅ‡∏ô‡∏ô‡∏õ‡∏±‡∏à‡∏à‡∏∏‡∏ö‡∏±‡∏ô</h3>
      <div id="currentScoreboard" class="scoreboard">
        <!-- Scoreboard will be populated here -->
      </div>
    </div>

    <!-- GAME OVER -->
    <div id="gameOver" class="card hide">
      <h1>üéâ ‡∏à‡∏ö‡πÄ‡∏Å‡∏°!</h1>
      
      <div id="gameStats" class="text-center mb-20">
        <!-- Game statistics will be shown here -->
      </div>

      <h2>üèÜ ‡∏ú‡∏•‡∏Å‡∏≤‡∏£‡πÅ‡∏Ç‡πà‡∏á‡∏Ç‡∏±‡∏ô‡∏™‡∏∏‡∏î‡∏ó‡πâ‡∏≤‡∏¢</h2>
      <div id="finalScoreboard" class="scoreboard">
        <!-- Final scoreboard will be populated here -->
      </div>

      <div class="text-center mt-20">
        <button onclick="location.reload()" class="btn success">üîÑ ‡πÄ‡∏•‡πà‡∏ô‡∏≠‡∏µ‡∏Å‡∏Ñ‡∏£‡∏±‡πâ‡∏á</button>
        <button id="viewStatsBtn" class="btn secondary hide">üìà ‡∏î‡∏π‡∏™‡∏ñ‡∏¥‡∏ï‡∏¥</button>
      </div>
    </div>
  </div>

  <!-- Sound Toggle -->
  <button class="sound-toggle" id="soundToggle">üîä</button>

  <!-- Notification Container -->
  <div id="notifications"></div>

  <script src="/socket.io/socket.io.js"></script>
  <script>
    // Global variables
    let socket;
    let currentUser = null;
    let currentRoom = null;
    let gameState = 'auth'; // auth, lobby, playing, summary, finished
    let soundEnabled = localStorage.getItem('kahoo-sound') !== 'false';
    let categories = [];

    // Audio context and sounds
    const audioContext = new (window.AudioContext || window.webkitAudioContext)();
    const sounds = {};

    // Initialize app
    document.addEventListener('DOMContentLoaded', init);

    async function init() {
      setupEventListeners();
      await loadCategories();
      initSounds();
      updateSoundToggle();
      
      // Check URL for room parameter
      const urlParams = new URLSearchParams(window.location.search);
      const roomId = urlParams.get('room');
      if (roomId) {
        document.getElementById('joinRoomId').value = roomId.toUpperCase();
      }
    }

    function setupEventListeners() {
      // Auth tabs
      document.querySelectorAll('.auth-tab').forEach(tab => {
        tab.addEventListener('click', () => switchAuthTab(tab.dataset.tab));
      });

      // Auth buttons
      document.getElementById('createGuestBtn').addEventListener('click', showSettings);
      document.getElementById('joinGuestBtn').addEventListener('click', joinAsGuest);
      document.getElementById('loginBtn').addEventListener('click', handleLogin);
      document.getElementById('registerBtn').addEventListener('click', handleRegister);

      // Settings
      document.getElementById('saveSettings').addEventListener('click', createRoomWithSettings);
      document.getElementById('cancelSettings').addEventListener('click', () => showScreen('auth'));

      // Lobby
      document.getElementById('startGameBtn').addEventListener('click', startGame);
      document.getElementById('leaveRoomBtn').addEventListener('click', leaveRoom);

      // Sound toggle
      document.getElementById('soundToggle').addEventListener('click', toggleSound);

      // Keyboard shortcuts
      document.addEventListener('keydown', handleKeyboard);
    }

    function switchAuthTab(tab) {
      document.querySelectorAll('.auth-tab').forEach(t => t.classList.remove('active'));
      document.querySelectorAll('.auth-content').forEach(c => c.classList.add('hide'));
      
      document.querySelector(`[data-tab="${tab}"]`).classList.add('active');
      document.getElementById(`${tab}-tab`).classList.remove('hide');
    }

    async function loadCategories() {
      try {
        const response = await fetch('/api/categories');
        categories = await response.json();
        
        const categorySelect = document.getElementById('category');
        categories.forEach(cat => {
          const option = document.createElement('option');
          option.value = cat.id;
          option.textContent = `${cat.icon} ${cat.name}`;
          categorySelect.appendChild(option);
        });
      } catch (error) {
        console.error('Failed to load categories:', error);
      }
    }

    // Sound system
    function initSounds() {
      // Create simple beep sounds using Web Audio API
      sounds.correct = createBeep(800, 0.2, 'sine');
      sounds.incorrect = createBeep(300, 0.3, 'sawtooth');
      sounds.tick = createBeep(600, 0.1, 'square');
      sounds.start = createBeep(1000, 0.5, 'triangle');
      sounds.finish = createBeep(500, 1, 'sine');
    }

    function createBeep(frequency, duration, type = 'sine') {
      return () => {
        if (!soundEnabled) return;
        
        const oscillator = audioContext.createOscillator();
        const gainNode = audioContext.createGain();
        
        oscillator.connect(gainNode);
        gainNode.connect(audioContext.destination);
        
        oscillator.frequency.value = frequency;
        oscillator.type = type;
        
        gainNode.gain.setValueAtTime(0.1, audioContext.currentTime);
        gainNode.gain.exponentialRampToValueAtTime(0.01, audioContext.currentTime + duration);
        
        oscillator.start(audioContext.currentTime);
        oscillator.stop(audioContext.currentTime + duration);
      };
    }

    function playSound(soundName) {
      if (sounds[soundName]) {
        sounds[soundName]();
      }
    }

    function toggleSound() {
      soundEnabled = !soundEnabled;
      localStorage.setItem('kahoo-sound', soundEnabled.toString());
      updateSoundToggle();
      
      if (soundEnabled) {
        playSound('tick');
      }
    }

    function updateSoundToggle() {
      const toggle = document.getElementById('soundToggle');
      toggle.textContent = soundEnabled ? 'üîä' : 'üîá';
      toggle.classList.toggle('muted', !soundEnabled);
    }

    // Notification system
    function showNotification(message, type = 'info', duration = 3000) {
      const notification = document.createElement('div');
      notification.className = `notification ${type}`;
      notification.textContent = message;
      
      document.getElementById('notifications').appendChild(notification);
      
      setTimeout(() => {
        notification.remove();
      }, duration);
    }

    // Screen management
    function showScreen(screen) {
      document.querySelectorAll('.card').forEach(card => card.classList.add('hide'));
      document.getElementById(screen).classList.remove('hide');
      gameState = screen;
    }

    // Authentication
    function showSettings() {
      const guestName = document.getElementById('guestName').value.trim();
      if (!guestName) {
        showNotification('‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡πÉ‡∏™‡πà‡∏ä‡∏∑‡πà‡∏≠‡∏ú‡∏π‡πâ‡πÄ‡∏•‡πà‡∏ô', 'error');
        return;
      }
      showScreen('settings');
    }

    function joinAsGuest() {
      const guestName = document.getElementById('guestName').value.trim();
      const roomId = document.getElementById('joinRoomId').value.trim().toUpperCase();
      
      if (!guestName) {
        showNotification('‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡πÉ‡∏™‡πà‡∏ä‡∏∑‡πà‡∏≠‡∏ú‡∏π‡πâ‡πÄ‡∏•‡πà‡∏ô', 'error');
        return;
      }
      
      if (!roomId || roomId.length !== 6) {
        showNotification('‡∏£‡∏´‡∏±‡∏™‡∏´‡πâ‡∏≠‡∏á‡∏ï‡πâ‡∏≠‡∏á‡πÄ‡∏õ‡πá‡∏ô 6 ‡∏ï‡∏±‡∏ß‡∏≠‡∏±‡∏Å‡∏©‡∏£', 'error');
        return;
      }

      currentUser = { username: guestName, isGuest: true };
      connectSocket();
      joinRoom(roomId);
    }

    async function handleLogin() {
      const usernameOrEmail = document.getElementById('loginInput').value.trim();
      const password = document.getElementById('loginPassword').value;
      
      if (!usernameOrEmail || !password) {
        showNotification('‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡∏Å‡∏£‡∏≠‡∏Å‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡πÉ‡∏´‡πâ‡∏Ñ‡∏£‡∏ö', 'error');
        return;
      }

      const btn = document.getElementById('loginBtn');
      btn.classList.add('loading');
      btn.disabled = true;

      try {
        const response = await fetch('/api/auth/login', {
          method: 'POST',
          headers: { 'Content-Type': 'application/json' },
          body: JSON.stringify({ usernameOrEmail, password })
        });

        const data = await response.json();
        
        if (data.success) {
          currentUser = data.user;
          currentUser.isGuest = false;
          showNotification(`‡∏¢‡∏¥‡∏ô‡∏î‡∏µ‡∏ï‡πâ‡∏≠‡∏ô‡∏£‡∏±‡∏ö ${data.user.username}!`, 'success');
          showScreen('settings');
          connectSocket();
        } else {
          showNotification(data.error || '‡πÄ‡∏Ç‡πâ‡∏≤‡∏™‡∏π‡πà‡∏£‡∏∞‡∏ö‡∏ö‡πÑ‡∏°‡πà‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à', 'error');
        }
      } catch (error) {
        showNotification('‡πÄ‡∏Å‡∏¥‡∏î‡∏Ç‡πâ‡∏≠‡∏ú‡∏¥‡∏î‡∏û‡∏•‡∏≤‡∏î‡πÉ‡∏ô‡∏Å‡∏≤‡∏£‡πÄ‡∏ä‡∏∑‡πà‡∏≠‡∏°‡∏ï‡πà‡∏≠', 'error');
      } finally {
        btn.classList.remove('loading');
        btn.disabled = false;
      }
    }

    async function handleRegister() {
      const username = document.getElementById('registerUsername').value.trim();
      const email = document.getElementById('registerEmail').value.trim();
      const password = document.getElementById('registerPassword').value;
      
      if (!username || !email || !password) {
        showNotification('‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡∏Å‡∏£‡∏≠‡∏Å‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡πÉ‡∏´‡πâ‡∏Ñ‡∏£‡∏ö', 'error');
        return;
      }

      if (password.length < 6) {
        showNotification('‡∏£‡∏´‡∏±‡∏™‡∏ú‡πà‡∏≤‡∏ô‡∏ï‡πâ‡∏≠‡∏á‡∏°‡∏µ‡∏≠‡∏¢‡πà‡∏≤‡∏á‡∏ô‡πâ‡∏≠‡∏¢ 6 ‡∏ï‡∏±‡∏ß‡∏≠‡∏±‡∏Å‡∏©‡∏£', 'error');
        return;
      }

      const btn = document.getElementById('registerBtn');
      btn.classList.add('loading');
      btn.disabled = true;

      try {
        const response = await fetch('/api/auth/register', {
          method: 'POST',
          headers: { 'Content-Type': 'application/json' },
          body: JSON.stringify({ username, email, password })
        });

        const data = await response.json();
        
        if (data.success) {
          currentUser = data.user;
          currentUser.isGuest = false;
          showNotification(`‡∏™‡∏°‡∏±‡∏Ñ‡∏£‡∏™‡∏°‡∏≤‡∏ä‡∏¥‡∏Å‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à! ‡∏¢‡∏¥‡∏ô‡∏î‡∏µ‡∏ï‡πâ‡∏≠‡∏ô‡∏£‡∏±‡∏ö ${data.user.username}`, 'success');
          showScreen('settings');
          connectSocket();
        } else {
          showNotification(data.error || '‡∏™‡∏°‡∏±‡∏Ñ‡∏£‡∏™‡∏°‡∏≤‡∏ä‡∏¥‡∏Å‡πÑ‡∏°‡πà‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à', 'error');
        }
      } catch (error) {
        showNotification('‡πÄ‡∏Å‡∏¥‡∏î‡∏Ç‡πâ‡∏≠‡∏ú‡∏¥‡∏î‡∏û‡∏•‡∏≤‡∏î‡πÉ‡∏ô‡∏Å‡∏≤‡∏£‡πÄ‡∏ä‡∏∑‡πà‡∏≠‡∏°‡∏ï‡πà‡∏≠', 'error');
      } finally {
        btn.classList.remove('loading');
        btn.disabled = false;
      }
    }

    // Socket connection
    function connectSocket() {
      const auth = currentUser.isGuest 
        ? { username: currentUser.username }
        : { token: currentUser.token };

      socket = io({
        auth: auth,
        transports: ['websocket', 'polling']
      });

      socket.on('connect', () => {
        console.log('Connected to server');
        showNotification('‡πÄ‡∏ä‡∏∑‡πà‡∏≠‡∏°‡∏ï‡πà‡∏≠‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à!', 'success', 2000);
      });

      socket.on('disconnect', () => {
        showNotification('‡∏Å‡∏≤‡∏£‡πÄ‡∏ä‡∏∑‡πà‡∏≠‡∏°‡∏ï‡πà‡∏≠‡∏Ç‡∏≤‡∏î‡∏´‡∏≤‡∏¢‡πÑ‡∏õ', 'error');
      });

      socket.on('roomCreated', handleRoomCreated);
      socket.on('joinedRoom', handleJoinedRoom);
      socket.on('lobbyPlayers', updateLobbyPlayers);
      socket.on('gameStarted', handleGameStarted);
      socket.on('question', handleQuestion);
      socket.on('timer', updateTimer);
      socket.on('questionSummary', handleQuestionSummary);
      socket.on('scoreboard', updateScoreboard);
      socket.on('gameOver', handleGameOver);
      socket.on('answerSubmitted', handleAnswerSubmitted);
      socket.on('errorMessage', (msg) => showNotification(msg, 'error'));

      socket.on('connect_error', (error) => {
        showNotification('‡πÑ‡∏°‡πà‡∏™‡∏≤‡∏°‡∏≤‡∏£‡∏ñ‡πÄ‡∏ä‡∏∑‡πà‡∏≠‡∏°‡∏ï‡πà‡∏≠‡πÑ‡∏î‡πâ: ' + error.message, 'error');
      });
    }

    // Game functions
    function createRoomWithSettings() {
      const settings = {
        questionCount: parseInt(document.getElementById('questionCount').value),
        timeLimit: parseInt(document.getElementById('timeLimit').value),
        category: parseInt(document.getElementById('category').value) || null,
        difficulty: document.getElementById('difficulty').value || null
      };

      socket.emit('createRoom', { settings });
    }

    function joinRoom(roomId) {
      socket.emit('join', { 
        roomId: roomId,
        playerName: currentUser.username 
      });
    }

    function startGame() {
      if (currentRoom) {
        socket.emit('startGame', { roomId: currentRoom.id });
        playSound('start');
      }
    }

    function leaveRoom() {
      if (socket) {
        socket.disconnect();
      }
      showScreen('auth');
      currentRoom = null;
      showNotification('‡∏≠‡∏≠‡∏Å‡∏à‡∏≤‡∏Å‡∏´‡πâ‡∏≠‡∏á‡πÅ‡∏•‡πâ‡∏ß', 'info');
    }

    function submitAnswer(answerIndex) {
      if (currentRoom && gameState === 'playing') {
        socket.emit('answer', { 
          roomId: currentRoom.id, 
          answerIndex: answerIndex 
        });
      }
    }

    // Socket event handlers
    function handleRoomCreated(data) {
      currentRoom = { id: data.roomId, settings: data.settings, isHost: true };
      showLobby();
    }

    function handleJoinedRoom(data) {
      currentRoom = { id: data.roomId, settings: data.settings, isHost: false };
      showLobby();
    }

    function showLobby() {
      document.getElementById('roomIdDisplay').textContent = currentRoom.id;
      const shareUrl = `${window.location.origin}?room=${currentRoom.id}`;
      document.getElementById('shareLink').dataset.url = shareUrl;
      
      document.getElementById('startGameBtn').style.display = currentRoom.isHost ? 'inline-block' : 'none';
      
      showScreen('lobby');
      showNotification(`‡πÄ‡∏Ç‡πâ‡∏≤‡∏´‡πâ‡∏≠‡∏á ${currentRoom.id} ‡πÅ‡∏•‡πâ‡∏ß`, 'success');
    }

    function updateLobbyPlayers(players) {
      const grid = document.getElementById('playersGrid');
      grid.innerHTML = '';
      
      players.forEach(player => {
        const playerCard = document.createElement('div');
        playerCard.className = `player-card ${player.isHost ? 'host' : ''}`;
        playerCard.innerHTML = `
          <div>üë§ ${player.name}</div>
          ${player.isHost ? '<div style="font-size: 12px; color: gold;">Host</div>' : ''}
        `;
        grid.appendChild(playerCard);
      });

      // Enable start button if host and has players
      if (currentRoom && currentRoom.isHost) {
        document.getElementById('startGameBtn').disabled = players.length === 0;
      }
    }

    function handleGameStarted() {
      showScreen('game');
      showNotification('‡πÄ‡∏Å‡∏°‡πÄ‡∏£‡∏¥‡πà‡∏°‡πÅ‡∏•‡πâ‡∏ß!', 'success');
      playSound('start');
    }

    function handleQuestion(questionData) {
      gameState = 'playing';
      
      // Update question info
      document.getElementById('questionNumber').textContent = questionData.index;
      document.getElementById('totalQuestions').textContent = questionData.total;
      document.getElementById('questionText').textContent = questionData.question;
      
      // Update progress bar
      const progress = (questionData.index - 1) / questionData.total * 100;
      document.getElementById('progressFill').style.width = progress + '%';
      
      // Update category and difficulty
      document.getElementById('questionCategory').textContent = questionData.category || 'General';
      const difficultyBadge = document.getElementById('questionDifficulty');
      difficultyBadge.textContent = questionData.difficulty || 'Medium';
      difficultyBadge.className = `difficulty-badge difficulty-${questionData.difficulty || 'medium'}`;

      // Create options
      const optionsGrid = document.getElementById('optionsGrid');
      optionsGrid.innerHTML = '';
      
      const colors = ['opt1', 'opt2', 'opt3', 'opt4'];
      
      questionData.options.forEach((option, index) => {
        const button = document.createElement('button');
        button.className = `option ${colors[index]}`;
        button.innerHTML = `<span>${option}</span>`;
        button.onclick = () => selectAnswer(button, index);
        optionsGrid.appendChild(button);
      });
    }

    function selectAnswer(button, answerIndex) {
      if (gameState !== 'playing') return;
      
      // Disable all options
      document.querySelectorAll('.option').forEach(opt => {
        opt.disabled = true;
        opt.style.cursor = 'not-allowed';
      });
      
      // Mark selected
      button.classList.add('selected');
      
      // Submit answer
      submitAnswer(answerIndex);
      playSound('tick');
    }

    function updateTimer(timeLeft) {
      const timerDisplay = document.getElementById('timerDisplay');
      const timerCircle = document.getElementById('timerCircle');
      
      timerDisplay.textContent = timeLeft;
      
      // Update circular progress
      const maxTime = currentRoom ? currentRoom.settings.timeLimit : 10;
      const percentage = (timeLeft / maxTime) * 100;
      timerCircle.style.setProperty('--pct', percentage);
      
      // Add warning animation when time is low
      if (timeLeft <= 3 && timeLeft > 0) {
        timerCircle.classList.add('warning');
        playSound('tick');
      } else {
        timerCircle.classList.remove('warning');
      }
    }

    function handleQuestionSummary(data) {
      gameState = 'summary';
      showScreen('summary');
      
      document.getElementById('summaryNumber').textContent = data.index;
      document.getElementById('summaryTotal').textContent = data.total;
      
      // Show correct answer
      const answerReveal = document.getElementById('answerReveal');
      answerReveal.innerHTML = `
        <div style="font-size: 18px; font-weight: 600; color: var(--success);">
          ‚úÖ ‡πÄ‡∏â‡∏•‡∏¢: ‡∏ï‡∏±‡∏ß‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏ó‡∏µ‡πà ${data.correctAnswer + 1}
        </div>
        ${data.explanation ? `<div style="margin-top: 10px; opacity: 0.8;">${data.explanation}</div>` : ''}
        ${data.endedEarly ? '<div style="color: var(--warning); margin-top: 5px;">‚ö° ‡∏ú‡∏π‡πâ‡πÄ‡∏•‡πà‡∏ô‡∏ó‡∏∏‡∏Å‡∏Ñ‡∏ô‡∏ï‡∏≠‡∏ö‡∏Ñ‡∏£‡∏ö‡πÅ‡∏•‡πâ‡∏ß</div>' : ''}
      `;
    }

    function updateScoreboard(scoreboard) {
      const containers = ['currentScoreboard', 'finalScoreboard'];
      
      containers.forEach(containerId => {
        const container = document.getElementById(containerId);
        if (!container) return;
        
        container.innerHTML = '';
        
        scoreboard.forEach((player, index) => {
          const row = document.createElement('div');
          row.className = 'score-row';
          
          const position = index + 1;
          let positionIcon = '';
          if (position === 1) positionIcon = 'üëë';
          else if (position === 2) positionIcon = 'ü•à';
          else if (position === 3) positionIcon = 'ü•â';
          
          row.innerHTML = `
            <div class="score-position">${positionIcon} ${position}.</div>
            <div class="score-name">
              ${player.name} ${player.isHost ? 'üëë' : ''}
            </div>
            <div class="score-points">${player.score} ‡∏Ñ‡∏∞‡πÅ‡∏ô‡∏ô</div>
          `;
          
          container.appendChild(row);
        });
      });
    }

    function handleAnswerSubmitted(data) {
      showNotification('‡∏™‡πà‡∏á‡∏Ñ‡∏≥‡∏ï‡∏≠‡∏ö‡πÅ‡∏•‡πâ‡∏ß!', 'success', 1500);
    }

    function handleGameOver(data) {
      gameState = 'finished';
      showScreen('gameOver');
      
      const gameStats = document.getElementById('gameStats');
      const duration = Math.round(data.duration / 1000);
      const minutes = Math.floor(duration / 60);
      const seconds = duration % 60;
      
      gameStats.innerHTML = `
        <div style="font-size: 16px; margin-bottom: 10px;">
          üïí ‡πÄ‡∏ß‡∏•‡∏≤‡∏ó‡∏µ‡πà‡πÉ‡∏ä‡πâ: ${minutes}:${seconds.toString().padStart(2, '0')}
        </div>
        <div style="font-size: 16px;">
          üìù ‡∏à‡∏≥‡∏ô‡∏ß‡∏ô‡∏Ñ‡∏≥‡∏ñ‡∏≤‡∏°: ${data.totalQuestions} ‡∏Ç‡πâ‡∏≠
        </div>
      `;
      
      playSound('finish');
      showNotification('‡πÄ‡∏Å‡∏°‡∏à‡∏ö‡πÅ‡∏•‡πâ‡∏ß! üéâ', 'success', 4000);
      
      // Show stats button for registered users
      if (!currentUser.isGuest) {
        document.getElementById('viewStatsBtn').classList.remove('hide');
      }
    }

    // Utility functions
    function copyShareLink() {
      const url = document.getElementById('shareLink').dataset.url;
      if (url) {
        navigator.clipboard.writeText(url).then(() => {
          showNotification('‡∏Ñ‡∏±‡∏î‡∏•‡∏≠‡∏Å‡∏•‡∏¥‡∏á‡∏Å‡πå‡πÅ‡∏•‡πâ‡∏ß!', 'success', 2000);
        }).catch(() => {
          showNotification('‡πÑ‡∏°‡πà‡∏™‡∏≤‡∏°‡∏≤‡∏£‡∏ñ‡∏Ñ‡∏±‡∏î‡∏•‡∏≠‡∏Å‡πÑ‡∏î‡πâ', 'error');
        });
      }
    }

    function handleKeyboard(event) {
      if (gameState === 'playing') {
        const key = event.key;
        if (['1', '2', '3', '4'].includes(key)) {
          const index = parseInt(key) - 1;
          const option = document.querySelectorAll('.option')[index];
          if (option && !option.disabled) {
            selectAnswer(option, index);
          }
        }
      }
    }

    // Expose functions to global scope for inline event handlers
    window.copyShareLink = copyShareLink;
  </script>
</body>
</html>